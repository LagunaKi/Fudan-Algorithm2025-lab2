# DNA序列复杂比对工具（锚点链式比对）

## 功能简介
本项目实现了基于minimizer稀疏化kmer哈希、锚点合并、DP最长无重叠链、gap区间Smith-Waterman局部比对的DNA序列比对算法，适用于复杂变异场景。

## 主要特性
- 支持大规模DNA序列的高效比对
- 能识别插入、删除、突变、移位、倒位等多种变异
- 采用minimizer稀疏化+锚点链式结构，gap区间自动局部比对
- 主链自动识别倒位（逆转）突变，且保证query/ref区间无重叠
- 匹配区间自动合并，输出唯一、无重叠的区间列表

## 目录结构
```
src/
  dna_matcher.py  # 主算法实现
  __main__.py     # 命令行入口
requirements.txt  # 依赖
README.md         # 项目说明
```

## 安装依赖
```bash
pip install -r requirements.txt
```

## 用法
假设有input.txt：
```bash
python -m src input.txt
```
输出格式为一个中括号包裹的区间列表：
```
[(query_start, query_end, ref_start, ref_end), ...]
```

## 算法详细流程说明

### 1. minimizer稀疏化锚点提取（支持倒位）
- 对query的正向和反向互补序列，分别用minimizer稀疏化提取所有长度为k的完全匹配片段（锚点）。
  - minimizer：每w窗口内只保留字典序最小的kmer，极大减少冗余锚点。
- 每个锚点记录其在query、reference中的起始位置、长度和方向（正向/反向）。

### 2. 合并连续锚点
- 对query和ref上都连续的、方向一致的锚点进行合并，得到更长的锚点片段。

### 3. 主链DP（最长无重叠链，支持倒位）
- 对所有锚点，按ref坐标排序。
- 用动态规划（DP）+二分查找，寻找一条覆盖最多锚点的"主链"，要求：
  - 任意两个主链锚点的query区间和ref区间都**无重叠**。
  - DP转移时允许方向切换（正向↔反向），但区间顺序和无重叠性必须满足。
  - 这样主链可自动跨越倒位片段。

### 4. gap区间Smith-Waterman局部比对
- 对主链锚点之间未被覆盖的gap区间，采用Smith-Waterman局部比对（纯Python实现），补全剩余的匹配区间。
- gap区间过大时自动分块递归，保证整体效率。

### 5. 匹配区间合并
- 对主链和gap区间的所有匹配区间，自动合并连续的区间，输出最终结果。
- 输出的每个区间唯一且无重叠，方向信息可通过区间起止判断。

### 6. 结果解读
- 输出为[(q_start, q_end, r_start, r_end), ...]，整体用中括号包裹。
- 若q_start < q_end，表示正向匹配；若q_start > q_end，表示倒位（逆转）匹配。
- 每个query/ref区间只会在主链中出现一次。

## 备注
- gap区间的局部比对为纯Python实现，无需外部库
- k值、w值、gap处理等参数可根据实际需求调整
- 输出格式与打分函数完全兼容，可直接用于自动评测 